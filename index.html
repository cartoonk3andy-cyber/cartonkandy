<!DOCTYPE html>
<html lang="ar" dir="rtl" data-bs-theme="dark">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>free chatgpt plus</title>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7998736288062269"
         crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2j+FWyQ0/K5mJnnGa50IDWSYder3igpkNyxYA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* هنا هتلزق كود الـ CSS بالكامل
           اللي هبعتهولك في (الرسالة التانية)
        */
    </style>

</head>
<body>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        /*
           هنا هتلزق كود الـ JavaScript بالكامل
           اللي هبعتهولك في (الرسالة التالتة)
        */
    </script>

</body>
</html>
<nav class="navbar navbar-expand-lg sticky-top shadow-sm">
  <div class="container-fluid-custom">
    <a class="navbar-brand" href="#" id="siteLogoLink">
      <img src="https://via.placeholder.com/40x40/ffb703/000000?text=F" alt="Logo" id="siteLogoImg">
      <span id="siteTitle">Foxy Store</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="#">الرئيسية</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            الفئات
          </a>
          <ul class="dropdown-menu dropdown-menu-dark" id="categoryDropdown">
            </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#hot-deals-section">المنتجات المخفضة</a>
        </li>
      </ul>
      <form class="d-flex search-input-group me-3" role="search" id="globalSearchForm">
        <input class="form-control me-2" type="search" placeholder="ابحث عن منتجات..." aria-label="Search" id="globalSearchInput">
        <button class="btn" type="submit"><i class="fas fa-search"></i></button>
      </form>
      <ul class="navbar-nav navbar-icons">
        <li class="nav-item">
          <a class="nav-link" href="#" id="cartButton" data-bs-toggle="modal" data-bs-target="#cartModal" title="سلة المشتريات">
            <i class="fas fa-shopping-cart"></i>
            <span class="badge text-bg-warning" id="cartBadge">0</span>
          </a>
        </li>
        <li class="nav-item">
          <button class="btn btn-sm btn-outline-gold ms-3" type="button" data-bs-toggle="modal" data-bs-target="#settingsModal" title="الإعدادات">
            <i class="fas fa-cog"></i>
          </button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<section class="top-categories mb-5">
  <div class="container-fluid-custom">
    <div class="d-flex flex-wrap justify-content-center justify-content-lg-between gap-3" id="topCategoriesContainer">
      </div>
  </div>
</section>

<main class="flex-grow-1">
  <div class="container-fluid-custom">

    <section class="mb-5" id="our-picks-section">
      <h2 class="product-section-title">Our Picks</h2>
      <div class="row g-4" id="ourPicksGrid">
        </div>
    </section>

    <section class="mb-5" id="latest-releases-section">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="product-section-title mb-0">Latest Releases</h2>
        <a href="#" class="btn btn-sm btn-outline-gold section-discover-all">اكتشف الكل <i class="fas fa-arrow-left me-1"></i></a>
      </div>
      <div class="product-slider-container">
        <div class="d-inline-flex" id="latestReleasesSlider">
          </div>
      </div>
    </section>

    <section class="mb-5" id="best-sellers-section">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="product-section-title mb-0">Best Sellers</h2>
        <a href="#" class="btn btn-sm btn-outline-gold section-discover-all">اكتشف الكل <i class="fas fa-arrow-left me-1"></i></a>
      </div>
      <div class="product-slider-container">
        <div class="d-inline-flex" id="bestSellersSlider">
          </div>
      </div>
    </section>

    <section class="mb-5" id="hot-deals-section">
        <h2 class="product-section-title">Hot Deals</h2>
        <div class="row g-4" id="hotDealsGrid">
            </div>
    </section>

  </div>
</main>

<footer class="footer">
  <div class="container-fluid-custom">
    <div class="row g-4">
      <div class="col-lg-4 col-md-6">
        <a class="navbar-brand fs-4 mb-3" href="#" id="footerLogoLink">
          <img src="https://via.placeholder.com/40x40/ffb703/000000?text=F" alt="Logo" id="footerLogoImg">
          <span id="footerSiteTitle">Foxy Store</span>
        </a>
        <p class="mb-3" id="footerDescription">متجرك الأول للمنتجات الرقمية. نقدم أفضل الحلول البرمجية والاشتراكات بأسعار تنافسية.</p>
        <div class="social-icons" id="footerSocialIcons">
          <a href="#" target="_blank" title="Facebook"><i class="fab fa-facebook"></i></a>
          <a href="#" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
          <a href="#" target="_blank" title="TikTok"><i class="fab fa-tiktok"></i></a>
          <a href="#" target="_blank" title="Telegram"><i class="fab fa-telegram"></i></a>
        </div>
      </div>
      <div class="col-lg-2 col-md-3 col-6">
        <h5 class="footer-title">روابط سريعة</h5>
        <div class="footer-links">
          <a href="#">الرئيسية</a>
          <a href="#">كل المنتجات</a>
          <a href="#">الأسئلة الشائعة</a>
          <a href="#">تواصل معنا</a>
        </div>
      </div>
      <div class="col-lg-2 col-md-3 col-6">
        <h5 class="footer-title">الفئات</h5>
        <div class="footer-links" id="footerCategoryLinks">
          </div>
      </div>
      <div class="col-lg-4 col-md-12">
        <h5 class="footer-title">وسائل الدفع المتاحة</h5>
        <p id="footerPaymentText">نقبل جميع وسائل الدفع الممكنة عبر تيليجرام. تواصل معنا لإتمام الدفع بأي عملة تفضلها.</p>
        <img src="https://i.ibb.co/Q9d0m0N/payment-methods.png" alt="Payment Methods" class="img-fluid payment-methods-img">
      </div>
    </div>
    <hr class="footer-hr">
    <div class="text-center">
      <p class="mb-0" id="footerCopyright">© 2025 <span id="footerCopyrightName">Foxy Store</span>. كل الحقوق محفوظة.</p>
    </div>
  </div>
</footer>

<a href="#" id="whatsappFloatingBtn" class="whatsapp-floating-btn" target="_blank" title="تواصل معنا واتساب">
  <i class="fab fa-whatsapp"></i>
</a>

<div class="modal fade" id="productDetailModal" tabindex="-1" aria-labelledby="productDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-fullscreen-lg-down">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productDetailModalLabel">تفاصيل المنتج</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row">
          
          <div class="col-lg-5 mb-4 mb-lg-0">
            <img src="" id="mainProductImage" class="main-product-image mb-3" alt="صورة المنتج الرئيسية">
            <div class="d-flex justify-content-center product-image-gallery gap-2" id="productImageGallery">
              </div>
          </div>
          
          <div class="col-lg-7">
            <h1 class="mb-3 product-detail-title" id="productDetailTitle">اسم المنتج</h1>
            
            <div class="d-flex align-items-center mb-3">
              <span class="product-card-stars me-2" id="productDetailRating">
                </span>
              <span class="text-muted small" id="productDetailRatingCount">(0 تقييمات)</span>
            </div>
            
            <div class="mb-3">
              <span class="product-detail-price-old" id="productDetailPriceOld">$0.00</span>
              <span class="product-detail-price-new" id="productDetailPriceNew">$0.00</span>
              <span class="product-detail-discount-badge ms-2" id="productDetailDiscount">خصم 0%</span>
            </div>
            
            <div class="product-specs mb-3">
              <ul id="productDetailSpecs">
                </ul>
            </div>
            
            <a href="#" id="modalPurchaseLink" class="btn btn-gold btn-lg w-100 mb-3" target="_blank" rel="noopener noreferrer">
              <i class="fab fa-telegram me-2"></i>
              إتمام الشراء عبر تيليجرام
            </a>
            <div class="alert alert-info text-center" role="alert">
              <i class="fas fa-info-circle me-2"></i>
              نحن نقبل أي عملة! تواصل معنا عبر تيليجرام لإتمام الدفع.
            </div>

            <button class="btn btn-outline-gold w-100" id="modalAddToCartBtn">
              <i class="fas fa-shopping-cart me-2"></i>
              أضف إلى السلة
            </button>
          </div>
        </div>
        
        <hr class="my-4">
        
        <div class="row">
          <div class="col-12">
            <ul class="nav nav-tabs" id="productTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description-content" type="button" role="tab" aria-controls="description-content" aria-selected="true">الوصف</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews-content" type="button" role="tab" aria-controls="reviews-content" aria-selected="false">التقييمات</button>
              </li>
            </ul>
            <div class="tab-content pt-4" id="productTabsContent">
              <div class="tab-pane fade show active" id="description-content" role="tabpanel" aria-labelledby="description-tab">
                <h4 class="mb-3">الوصف (Description)</h4>
                <div id="productDetailDescription"></div>
              </div>
              <div class="tab-pane fade" id="reviews-content" role="tabpanel" aria-labelledby="reviews-tab">
                <div class="row">
                  <div class="col-md-5 mb-4">
                    <h4>التقييمات</h4>
                    <div class="review-summary-card">
                      <div class="review-summary-total">
                        <span id="reviewSummaryScore">5</span><small>/5</small>
                      </div>
                      <div class="review-summary-stars" id="reviewSummaryStars">
                        </div>
                      <small class="text-muted" id="reviewSummaryCount">(0 تقييمات)</small>
                    </div>
                    <div class="review-progress-bars" id="reviewProgressBars">
                      </div>
                  </div>
                  <div class="col-md-7">
                    <h4>أضف تعليقك</h4>
                    <form id="reviewForm" class="review-input">
                      <div class="mb-3">
                        <label for="reviewName" class="form-label">اسمك</label>
                        <input type="text" class="form-control" id="reviewName" placeholder="اكتب اسمك" required>
                      </div>
                      <div class="mb-3">
                        <label class="form-label">تقييمك</label>
                        <div class="rating-input" id="reviewRatingInput">
                          <i class="far fa-star" data-value="1"></i>
                          <i class="far fa-star" data-value="2"></i>
                          <i class="far fa-star" data-value="3"></i>
                          <i class="far fa-star" data-value="4"></i>
                          <i class="far fa-star" data-value="5"></i>
                        </div>
                      </div>
                      <div class="mb-3">
                        <label for="reviewComment" class="form-label">تعليقك</label>
                        <textarea class="form-control" id="reviewComment" rows="3" placeholder="اكتب تعليقك هنا..." required></textarea>
                      </div>
                      <button type="submit" class="btn btn-gold">إرسال التقييم</button>
                    </form>
                  </div>
                </div>
                <hr class="my-4">
                <h4 class="mb-3">تعليقات العملاء</h4>
                <div id="productDetailReviewsList">
                  </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cartModalLabel">سلة المشتريات</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="cartBody">
        </div>
      <div class="modal-footer justify-content-between">
        <div>
          <h5 class="mb-0">المجموع الكلي: <span class="text-warning" id="cartTotal">$0.00</span></h5>
        </div>
        <div>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">متابعة التسوق</button>
          <a href="#" id="cartCheckoutLink" class="btn btn-gold" target="_blank" rel="noopener noreferrer">
            <i class="fab fa-telegram me-2"></i>
            إتمام الشراء (تيليجرام)
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-fullscreen-lg-down">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="settingsModalLabel">لوحة التحكم</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        
        <div id="loginScreen">
          <label for="passInput" class="form-label">ادخل كلمة المرور</label>
          <input type="password" id="passInput" class="form-control mb-2" placeholder="كلمة السر">
          <button class="btn btn-gold w-100" id="loginBtn">دخول</button>
          <div id="loginError" class="text-danger mt-2 d-none">كلمة المرور خاطئة</div>
        </div>

        <div id="toolsScreen" class="d-none">
          <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="products-tab" data-bs-toggle="tab" data-bs-target="#products-tab-pane" type="button" role="tab">المنتجات</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="general-tab" data-bs-toggle="tab" data-bs-target="#general-tab-pane" type="button" role="tab">الإعدادات العامة</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="categories-tab" data-bs-toggle="tab" data-bs-target="#categories-tab-pane" type="button" role="tab">الفئات</button>
            </li>
          </ul>
          <div class="tab-content pt-4">
            <div class="tab-pane fade show active" id="products-tab-pane" role="tabpanel">
              <h4>محرر المنتجات (JSON)</h4>
              <p class="text-white-50 small">عدّل، احذف، أو أضف منتجات جديدة هنا.</p>
              <textarea id="productsEditor" class="form-control" rows="20" dir="ltr"></textarea>
            </div>
            <div class="tab-pane fade" id="general-tab-pane" role="tabpanel">
              <h4>الإعدادات العامة للمتجر</h4>
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="settingsSiteTitle" class="form-label">اسم الموقع</label>
                  <input type="text" id="settingsSiteTitle" class="form-control">
                </div>
                <div class="col-md-6">
                  <label for="settingsSiteLogo" class="form-label">رابط لوجو الموقع (URL)</label>
                  <input type="text" id="settingsSiteLogo" class="form-control">
                </div>
                <div class="col-md-6">
                  <label for="settingsTelegramLink" class="form-label">رابط تيليجرام (الافتراضي)</label>
                  <input type="text" id="settingsTelegramLink" class="form-control" placeholder="https://t.me/username">
                </div>
                <div class="col-md-6">
                  <label for="settingsWhatsappLink" class="form-label">رابط واتساب (للزر العائم)</label>
                  <input type="text" id="settingsWhatsappLink" class="form-control" placeholder="https://wa.me/...">
                </div>
                <div class="col-12">
                  <label for="settingsFooterText" class="form-label">الوصف في الفوتر</label>
                  <textarea id="settingsFooterText" class="form-control" rows="3"></textarea>
                </div>
                <div class="col-12">
                  <label for="settingsCopyright" class="form-label">نص الحقوق في الفوتر</label>
                  <input type="text" id="settingsCopyright" class="form-control">
                </div>
                <div class="col-12">
                  <label for="settingsSocialLinks" class="form-label">روابط السوشيال (JSON)</label>
                  <textarea id="settingsSocialLinks" class="form-control" rows="3" dir="ltr"></textarea>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="categories-tab-pane" role="tabpanel">
              <h4>محرر الفئات (JSON)</h4>
              <p class="text-white-50 small">الفئات العلوية التي تظهر في أول الصفحة.</p>
              <textarea id="categoriesEditor" class="form-control" rows="10" dir="ltr"></textarea>
            </div>
          </div>
          <hr>
          <button class="btn btn-primary w-100 btn-lg" id="saveBtn">حفظ جميع التغييرات</button>
        </div>
      </div>
    </div>
  </div>
</div>
/* ==================================================
   الرسالة التانية: كود CSS (التصميم الكامل)
   ================================================== */

/* ====== 1. المتغيرات الأساسية والثيم ====== */
:root {
  --foxy-gold: #ffb703;
  --foxy-gold-light: #ffd166;
  --foxy-gold-dark: #241700;
  --foxy-bg-dark: #121212;
  --foxy-card-bg: #1e1e1e;
  --foxy-border: rgba(255, 255, 255, 0.1);
  --foxy-text-color: #e0e0e0;
  --foxy-muted-text: #999;
  --foxy-red-discount: #dc3545;

  --bs-body-font-family: 'Cairo', "Roboto", system-ui, -apple-system, "Segoe UI", Arial;
  --bs-body-bg: var(--foxy-bg-dark);
  --bs-body-color: var(--foxy-text-color);
  --bs-link-color: var(--foxy-gold);
  --bs-link-hover-color: var(--foxy-gold-light);
  --bs-border-color: var(--foxy-border);
  --bs-secondary-bg: var(--foxy-card-bg);
  --bs-tertiary-bg: #2a2a2a;
}

/* ====== 2. تنسيقات عامة ====== */
body {
  background-color: var(--foxy-bg-dark);
  font-family: var(--bs-body-font-family);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  overflow-x: hidden;
}

h1, h2, h3, h4, h5, h6 {
  color: var(--foxy-text-color);
  font-weight: 600;
}

p {
  color: var(--foxy-muted-text);
  line-height: 1.7;
}

.container-fluid-custom {
  padding-left: 3rem;
  padding-right: 3rem;
}

/* ====== 3. الشريط العلوي (Navbar) ====== */
.navbar {
  background-color: rgba(18, 18, 18, 0.7) !important;
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--foxy-border);
  padding-top: .75rem;
  padding-bottom: .75rem;
}
.navbar-brand {
  color: var(--foxy-gold) !important;
  font-weight: 700;
  font-size: 1.5rem;
  display: flex;
  align-items: center;
}
.navbar-brand img {
  height: 35px;
  margin-inline-end: 10px;
  border-radius: 6px;
}
.navbar-nav .nav-link {
  color: var(--foxy-text-color) !important;
  font-weight: 500;
  margin-inline-end: 1rem;
  transition: color 0.2s;
}
.navbar-nav .nav-link.active,
.navbar-nav .nav-link:hover {
  color: var(--foxy-gold) !important;
}

/* شريط البحث */
.search-input-group {
  max-width: 350px;
}
.search-input-group .form-control {
  background-color: var(--bs-tertiary-bg);
  border: 1px solid var(--foxy-border);
  color: var(--foxy-text-color);
  border-radius: 0.375rem 0 0 0.375rem !important;
}
.search-input-group .form-control::placeholder {
  color: var(--foxy-muted-text);
}
.search-input-group .form-control:focus {
  background-color: var(--bs-tertiary-bg);
  border-color: var(--foxy-gold);
  color: var(--foxy-text-color);
  box-shadow: 0 0 0 0.25rem rgba(255, 183, 3, 0.25);
}
.search-input-group .btn {
  background-color: var(--foxy-gold);
  border-color: var(--foxy-gold);
  color: var(--foxy-gold-dark);
  border-radius: 0 0.375rem 0.375rem 0 !important;
  z-index: 2; /* لإظهار الزر فوق حقل البحث عند التركيز */
}
.search-input-group .btn:hover {
  background-color: var(--foxy-gold-light);
  border-color: var(--foxy-gold-light);
}

/* أيقونات السلة والإعدادات */
.navbar-icons .nav-link {
  font-size: 1.2rem;
  margin-inline-start: 1rem;
  position: relative;
}
.navbar-icons .nav-link .badge {
  position: absolute;
  top: 0;
  right: -5px;
  font-size: 0.65rem;
  padding: 3px 5px;
}
.btn-outline-gold {
  color: var(--foxy-gold);
  border-color: var(--foxy-gold);
}
.btn-outline-gold:hover {
  color: var(--foxy-gold-dark);
  background-color: var(--foxy-gold);
  border-color: var(--foxy-gold);
}

/* ====== 4. الأقسام العلوية (الفئات المميزة) ====== */
.top-categories {
  background-color: #1a1a1a;
  padding: 1.5rem 0;
  border-bottom: 1px solid var(--foxy-border);
}
.category-item {
  text-align: center;
  color: var(--foxy-text-color);
  text-decoration: none;
  display: block;
  transition: transform 0.2s ease, color 0.2s ease;
}
.category-item:hover {
  transform: translateY(-5px);
  color: var(--foxy-gold);
}
.category-item img {
  width: 60px;
  height: 60px;
  object-fit: contain;
  border-radius: 12px;
  margin-bottom: 8px;
  border: 1px solid var(--foxy-border);
  background-color: #2a2a2a;
}
.category-item span {
  font-size: 0.85rem;
  display: block;
  font-weight: 500;
}

/* ====== 5. أقسام المنتجات العامة ====== */
.product-section-title {
  color: var(--foxy-text-color);
  font-weight: 700;
  margin-bottom: 1.5rem;
  font-size: 1.8rem;
}
.section-discover-all {
  font-size: 0.9rem;
  font-weight: 600;
}

/* ====== 6. كارت المنتج (Product Card) ====== */
.product-card {
  background-color: var(--foxy-card-bg);
  border: 1px solid var(--foxy-border);
  border-radius: 0.75rem;
  overflow: hidden;
  position: relative;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  height: 100%;
  display: flex;
  flex-direction: column;
  cursor: pointer;
}
.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
}
.product-card-img-wrap {
  position: relative;
  width: 100%;
  padding-top: 100%; /* نسبة 1:1 */
  overflow: hidden;
}
.product-card-img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-bottom: 1px solid var(--foxy-border);
  transition: transform 0.3s ease;
}
.product-card:hover .product-card-img {
  transform: scale(1.05); /* زووم بسيط عند الهوفر */
}
.product-discount-badge {
  position: absolute;
  top: 10px;
  inset-inline-start: 10px;
  background-color: var(--foxy-red-discount);
  color: white;
  padding: 3px 8px;
  border-radius: 5px;
  font-size: 0.8rem;
  font-weight: 600;
  z-index: 10;
}
.product-sold-out-badge {
  position: absolute;
  top: 10px;
  inset-inline-start: 10px;
  background-color: #6c757d;
  color: white;
  padding: 3px 8px;
  border-radius: 5px;
  font-size: 0.8rem;
  font-weight: 600;
  z-index: 10;
}
.product-card-body {
  padding: 1rem;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}
.product-card-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--foxy-text-color);
  margin-bottom: 0.5rem;
  /* لضمان أن العنوان لا يتجاوز سطرين */
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;  
  overflow: hidden;
  text-overflow: ellipsis;
  min-height: 2.6em; /* ارتفاع سطرين تقريباً */
}
.product-card-stars {
  color: var(--foxy-gold);
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}
.product-card-prices {
  margin-top: auto; /* يدفع السعر لأسفل الكارد */
}
.product-card-price-old {
  color: var(--foxy-muted-text);
  text-decoration: line-through;
  font-size: 0.9rem;
  margin-inline-end: 8px;
}
.product-card-price-new {
  color: var(--foxy-gold);
  font-weight: 700;
  font-size: 1.1rem;
}

/* ====== 7. سلايدر المنتجات (Scrollable Sections) ====== */
.product-slider-container {
  overflow-x: auto;
  white-space: nowrap;
  padding-bottom: 1rem;
  -webkit-overflow-scrolling: touch;
}
.product-slider-container::-webkit-scrollbar {
  height: 8px;
}
.product-slider-container::-webkit-scrollbar-track {
  background: var(--bs-tertiary-bg);
  border-radius: 10px;
}
.product-slider-container::-webkit-scrollbar-thumb {
  background: var(--foxy-border);
  border-radius: 10px;
}
.product-slider-container::-webkit-scrollbar-thumb:hover {
  background: var(--foxy-muted-text);
}
.product-slider-item {
  display: inline-block;
  width: 280px;
  margin-inline-end: 1rem;
  vertical-align: top;
}
.product-slider-item:last-child {
  margin-inline-end: 0;
}
.product-slider-item .product-card-img-wrap {
  padding-top: 100%; /* 1:1 ratio */
}

/* ====== 8. الفوتر (Footer) ====== */
.footer {
  background-color: #1a1a1a;
  border-top: 1px solid var(--foxy-border);
  padding: 3rem 0 2rem;
  margin-top: auto;
}
.footer .footer-logo {
  height: 40px;
  border-radius: 6px;
}
.footer .social-icons a {
  color: var(--foxy-muted-text);
  font-size: 1.5rem;
  margin-inline-end: 1rem;
  transition: color 0.2s ease;
}
.footer .social-icons a:hover {
  color: var(--foxy-gold);
}
.footer-title {
  color: var(--foxy-text-color);
  font-weight: 600;
  font-size: 1.1rem;
  margin-bottom: 1rem;
}
.footer .footer-links a {
  color: var(--foxy-muted-text);
  text-decoration: none;
  display: block;
  margin-bottom: 0.5rem;
  transition: color 0.2s ease;
}
.footer .footer-links a:hover {
  color: var(--foxy-gold);
}
.footer .payment-methods-img {
  max-width: 250px;
  filter: grayscale(1) brightness(1.5);
  opacity: 0.7;
}
.footer .footer-hr {
  border-top: 1px solid var(--foxy-border);
  margin: 2rem 0;
}

/* ====== 9. زر الواتساب العائم ====== */
.whatsapp-floating-btn {
  position: fixed;
  bottom: 20px;
  inset-inline-start: 20px;
  background-color: #25d366;
  color: white;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
  z-index: 1000;
  transition: transform 0.2s ease;
  text-decoration: none;
}
.whatsapp-floating-btn:hover {
  transform: scale(1.1);
  color: white;
}

/* ====== 10. نافذة تفاصيل المنتج (Modal) ====== */
#productDetailModal .modal-content {
  background-color: var(--foxy-card-bg);
  border: 1px solid var(--foxy-border);
}
#productDetailModal .modal-header,
#productDetailModal .modal-footer {
  border-bottom: 1px solid var(--foxy-border);
  border-top: 1px solid var(--foxy-border);
}
#productDetailModal .modal-title {
  color: var(--foxy-text-color);
  font-weight: 700;
}
#productDetailModal .main-product-image {
  max-height: 400px;
  object-fit: cover;
  width: 100%;
  border: 1px solid var(--foxy-border);
  border-radius: 0.5rem;
}
#productDetailModal .product-image-gallery img {
  border: 1px solid var(--foxy-border);
  border-radius: 0.5rem;
  cursor: pointer;
  transition: border-color 0.2s ease;
  width: 80px;
  height: 80px;
  object-fit: cover;
}
#productDetailModal .product-image-gallery img:hover,
#productDetailModal .product-image-gallery img.active {
  border-color: var(--foxy-gold);
}
#productDetailModal .product-detail-title {
  font-size: 2rem;
  font-weight: 700;
}
#productDetailModal .product-detail-price-new {
  font-size: 2rem;
  font-weight: 700;
  color: var(--foxy-gold);
}
#productDetailModal .product-detail-price-old {
  color: var(--foxy-muted-text);
  text-decoration: line-through;
  font-size: 1.2rem;
  margin-inline-end: 1rem;
}
#productDetailModal .product-detail-discount-badge {
  background-color: var(--foxy-red-discount);
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
  font-size: 1rem;
  font-weight: 600;
}
#productDetailModal .product-specs ul {
  list-style: none;
  padding-inline-start: 0;
}
#productDetailModal .product-specs li {
  background-color: var(--bs-tertiary-bg);
  border: 1px solid var(--foxy-border);
  padding: 8px 12px;
  border-radius: 5px;
  margin-bottom: 5px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: var(--foxy-text-color);
}
#productDetailModal .product-specs li strong {
  color: var(--foxy-gold-light);
}
#productDetailModal .btn-gold {
  background-color: var(--foxy-gold);
  color: var(--foxy-gold-dark);
  font-weight: 700;
  font-size: 1.2rem;
  border: none;
}
#productDetailModal .btn-gold:hover {
  background-color: var(--foxy-gold-light);
  color: var(--foxy-gold-dark);
}
#productDetailModal .btn-outline-gold {
  color: var(--foxy-gold);
  border-color: var(--foxy-gold);
  font-weight: 700;
}
#productDetailModal .btn-outline-gold:hover {
  color: var(--foxy-gold-dark);
  background-color: var(--foxy-gold);
  border-color: var(--foxy-gold);
}

/* التقييمات والتعليقات */
#productDetailModal .nav-tabs .nav-link {
  color: var(--foxy-muted-text);
  border: none;
  border-bottom: 2px solid transparent;
}
#productDetailModal .nav-tabs .nav-link.active {
  color: var(--foxy-gold);
  border-bottom-color: var(--foxy-gold);
  background-color: transparent;
}
#productDetailModal .review-summary-card {
  background-color: var(--bs-tertiary-bg);
  border: 1px solid var(--foxy-border);
  border-radius: 0.75rem;
  padding: 1.5rem;
  text-align: center;
}
#productDetailModal .review-summary-total {
  font-size: 3rem;
  font-weight: 700;
  color: var(--foxy-text-color);
}
#productDetailModal .review-summary-total small {
  font-size: 1.5rem;
  color: var(--foxy-muted-text);
}
#productDetailModal .review-summary-stars {
  color: var(--foxy-gold);
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
}
#productDetailModal .review-progress-bars .progress {
  height: 8px;
  background-color: #444;
}
#productDetailModal .review-progress-bars .progress-bar {
  background-color: var(--foxy-gold);
}
#productDetailModal .rating-input {
  font-size: 1.5rem;
  color: var(--foxy-muted-text);
  cursor: pointer;
}
#productDetailModal .rating-input i:hover,
#productDetailModal .rating-input i.fas {
  color: var(--foxy-gold);
}
#productDetailModal .review-card {
  background-color: var(--bs-tertiary-bg);
  border: 1px solid var(--foxy-border);
  border-radius: 0.75rem;
  padding: 1rem;
  margin-bottom: 1rem;
}
#productDetailModal .review-card .review-stars {
  color: var(--foxy-gold);
}

/* ====== 11. نافذة سلة المشتريات (Cart Modal) ====== */
#cartModal .modal-content {
  background-color: var(--foxy-card-bg);
  border: 1px solid var(--foxy-border);
}
#cartModal .modal-header,
#cartModal .modal-footer {
  border-bottom: 1px solid var(--foxy-border);
  border-top: 1px solid var(--foxy-border);
}
#cartModal .cart-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding-bottom: 1rem;
  margin-bottom: 1rem;
  border-bottom: 1px solid var(--foxy-border);
}
#cartModal .cart-item:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}
#cartModal .cart-item-img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 0.5rem;
  border: 1px solid var(--foxy-border);
}
#cartModal .cart-item-details {
  flex-grow: 1;
}
#cartModal .cart-item-title {
  font-weight: 600;
  color: var(--foxy-text-color);
  margin-bottom: 0.25rem;
}
#cartModal .cart-item-price {
  color: var(--foxy-gold);
  font-weight: 600;
}
#cartModal .cart-item-quantity {
  width: 70px;
  background-color: var(--bs-tertiary-bg);
  border-color: var(--foxy-border);
  color: var(--foxy-text-color);
}
#cartModal .cart-item-remove {
  color: var(--foxy-red-discount);
  font-size: 1.2rem;
}
#cartModal .cart-empty-message {
  text-align: center;
  padding: 2rem;
  font-size: 1.2rem;
  color: var(--foxy-muted-text);
}
#cartModal .btn-gold {
  background-color: var(--foxy-gold);
  color: var(--foxy-gold-dark);
  font-weight: 700;
  border: none;
}
#cartModal .btn-gold:hover {
  background-color: var(--foxy-gold-light);
}

/* ====== 12. لوحة الإعدادات (Settings Modal) ====== */
#settingsModal .modal-content {
  background-color: var(--foxy-card-bg);
  border: 1px solid var(--foxy-border);
}
#settingsModal .modal-header,
#settingsModal .modal-footer {
  border-bottom: 1px solid var(--foxy-border);
  border-top: 1px solid var(--foxy-border);
}
#settingsModal .nav-tabs .nav-link {
  color: var(--foxy-muted-text);
  border: none;
  border-bottom: 2px solid transparent;
}
#settingsModal .nav-tabs .nav-link.active {
  color: var(--foxy-gold);
  border-bottom-color: var(--foxy-gold);
  background-color: transparent;
}
#settingsModal .form-control {
  background-color: var(--bs-tertiary-bg);
  border: 1px solid var(--foxy-border);
  color: var(--foxy-text-color);
}
#settingsModal .form-control::placeholder {
  color: var(--foxy-muted-text);
}
#settingsModal .form-label {
  color: var(--foxy-text-color);
}
#settingsModal textarea {
  font-family: 'Roboto Mono', monospace;
  font-size: 0.9rem;
}
#settingsModal .btn-primary {
  background-color: var(--foxy-gold);
  border-color: var(--foxy-gold);
  color: var(--foxy-gold-dark);
  font-weight: 700;
}
#settingsModal .btn-primary:hover {
  background-color: var(--foxy-gold-light);
  border-color: var(--foxy-gold-light);
}
#settingsModal .btn-gold {
  background-color: var(--foxy-gold);
  color: var(--foxy-gold-dark);
  font-weight: 700;
  border: none;
}
#settingsModal .btn-gold:hover {
  background-color: var(--foxy-gold-light);
}


/* ====== 13. تعديلات التجاوب (Responsive) ====== */
@media (max-width: 992px) {
  .container-fluid-custom {
    padding-left: 1rem;
    padding-right: 1rem;
  }
  .navbar-nav {
    align-items: center;
    padding-top: 1rem;
  }
  .search-input-group {
    max-width: 100%;
    margin-top: 1rem;
    margin-bottom: 1rem;
  }
  .navbar-icons {
    flex-direction: row;
    justify-content: center;
  }
  .product-slider-item {
    width: 220px; /* تصغير الكروت في السلايدر للموبايل */
  }
  .footer .footer-logo {
    display: block;
    margin: 0 auto 1rem;
    text-align: center;
  }
  .footer .social-icons {
    text-align: center;
    margin-bottom: 1.5rem;
  }
  .footer .footer-links {
    text-align: center;
  }
  .footer-title {
    text-align: center;
  }
}
/* ==================================================
   الرسالة الثالثة: كود JavaScript (البرمجة الكاملة)
   ================================================== */

// ======================= 0. الانتظار حتى تحميل الصفحة =======================
document.addEventListener('DOMContentLoaded', function () {

  // ======================= 1. تحديد العناصر الأساسية (Selectors) =======================
  const $ = (s) => document.getElementById(s);
  const $$ = (s) => document.querySelectorAll(s);

  // عناصر المتجر
  const siteTitle = $('siteTitle');
  const siteLogoImg = $('siteLogoImg');
  const categoryDropdown = $('categoryDropdown');
  const topCategoriesContainer = $('topCategoriesContainer');
  const globalSearchInput = $('globalSearchInput');
  const globalSearchForm = $('globalSearchForm');
  const whatsappFloatingBtn = $('whatsappFloatingBtn');
  
  // عناصر الفوتر
  const footerLogoImg = $('footerLogoImg');
  const footerSiteTitle = $('footerSiteTitle');
  const footerDescription = $('footerDescription');
  const footerSocialIcons = $('footerSocialIcons');
  const footerCategoryLinks = $('footerCategoryLinks');
  const footerPaymentText = $('footerPaymentText');
  const footerCopyrightName = $('footerCopyrightName');

  // أقسام المنتجات
  const ourPicksGrid = $('ourPicksGrid');
  const latestReleasesSlider = $('latestReleasesSlider');
  const bestSellersSlider = $('bestSellersSlider');
  const hotDealsGrid = $('hotDealsGrid');

  // نافذة تفاصيل المنتج
  const productDetailModalEl = $('productDetailModal');
  const productDetailModal = new bootstrap.Modal(productDetailModalEl);
  const productDetailTitle = $('productDetailTitle');
  const mainProductImage = $('mainProductImage');
  const productImageGallery = $('productImageGallery');
  const productDetailRating = $('productDetailRating');
  const productDetailRatingCount = $('productDetailRatingCount');
  const productDetailPriceOld = $('productDetailPriceOld');
  const productDetailPriceNew = $('productDetailPriceNew');
  const productDetailDiscount = $('productDetailDiscount');
  const productDetailSpecs = $('productDetailSpecs');
  const modalPurchaseLink = $('modalPurchaseLink');
  const modalAddToCartBtn = $('modalAddToCartBtn');
  const productDetailDescription = $('productDetailDescription');
  
  // نافذة التقييمات
  const reviewSummaryScore = $('reviewSummaryScore');
  const reviewSummaryStars = $('reviewSummaryStars');
  const reviewSummaryCount = $('reviewSummaryCount');
  const reviewProgressBars = $('reviewProgressBars');
  const productDetailReviewsList = $('productDetailReviewsList');
  const reviewForm = $('reviewForm');
  const reviewRatingInput = $('reviewRatingInput');
  let currentReviewRating = 0;

  // نافذة سلة المشتريات
  const cartModalEl = $('cartModal');
  const cartModal = new bootstrap.Modal(cartModalEl);
  const cartBody = $('cartBody');
  const cartBadge = $('cartBadge');
  const cartTotal = $('cartTotal');
  const cartCheckoutLink = $('cartCheckoutLink');
  
  // نافذة الإعدادات
  const settingsModalEl = $('settingsModal');
  const settingsModal = new bootstrap.Modal(settingsModalEl);
  const loginScreen = $('loginScreen');
  const toolsScreen = $('toolsScreen');
  const passInput = $('passInput');
  const loginBtn = $('loginBtn');
  const loginError = $('loginError');
  const saveBtn = $('saveBtn');

  // حقول الإعدادات
  const productsEditor = $('productsEditor');
  const categoriesEditor = $('categoriesEditor');
  const settingsSiteTitle = $('settingsSiteTitle');
  const settingsSiteLogo = $('settingsSiteLogo');
  const settingsTelegramLink = $('settingsTelegramLink');
  const settingsWhatsappLink = $('settingsWhatsappLink');
  const settingsFooterText = $('settingsFooterText');
  const settingsCopyright = $('settingsCopyright');
  const settingsSocialLinks = $('settingsSocialLinks');

  // ======================= 2. حالة التطبيق (State) =======================
  // هذه هي البيانات الافتراضية للمتجر. سيتم حفظها في localStorage
  let state = {
    secret: "zozasofsa12345678901",
    settings: {
      siteTitle: "Foxy Store",
      siteLogo: "https://via.placeholder.com/40x40/ffb703/000000?text=F",
      telegramLink: "https://t.me/YourUsername",
      whatsappLink: "https://wa.me/123456789",
      footerText: "متجرك الأول للمنتجات الرقمية. نقدم أفضل الحلول البرمجية والاشتراكات بأسعار تنافسية.",
      copyrightText: "Foxy Store",
      socials: [
        { "icon": "fab fa-facebook", "link": "https://facebook.com" },
        { "icon": "fab fa-instagram", "link": "https://instagram.com" },
        { "icon": "fab fa-tiktok", "link": "https://tiktok.com" },
        { "icon": "fab fa-telegram", "link": "https://telegram.org" }
      ]
    },
    categories: [
      { "name": "AI", "image": "https://via.placeholder.com/60x60/343a40/ffffff?text=AI", "link": "#" },
      { "name": "ChatGPT", "image": "https://via.placeholder.com/60x60/343a40/ffffff?text=GPT", "link": "#" },
      { "name": "Career", "image": "https://via.placeholder.com/60x60/343a40/ffffff?text=Career", "link": "#" },
      { "name": "Design", "image": "https://via.placeholder.com/60x60/343a40/ffffff?text=Design", "link": "#" },
      { "name": "Education", "image": "https://via.placeholder.com/60x60/343a40/ffffff?text=Edu", "link": "#" },
      { "name": "Software", "image": "https://via.placeholder.com/60x60/343a40/ffffff?text=Code", "link": "#" },
      { "name": "Subscription", "image": "https://via.placeholder.com/60x60/343a40/ffffff?text=Sub", "link": "#" }
    ],
    products: [
      {
        "id": "chatgpt-plus",
        "title": "ChatGPT Plus | Latest Version & Features",
        "price": 5.00,
        "oldPrice": 8.00,
        "rating": 4.5,
        "ratingCount": 150,
        "soldOut": false,
        "categories": ["AI", "Featured", "BestSeller"],
        "mainImage": "https://i.ibb.co/FmP8wBq/chatgpt-plus-product-image.jpg",
        "galleryImages": [
          "https://i.ibb.co/FmP8wBq/chatgpt-plus-product-image.jpg",
          "https://via.placeholder.com/400x400/1e1e1e/ffffff?text=Feature+1",
          "https://via.placeholder.com/400x400/1e1e1e/ffffff?text=Feature+2"
        ],
        "specs": [
          { "key": "نوع المنتج", "value": "اشتراك رقمي" },
          { "key": "المنصة", "value": "OpenAI" },
          { "key": "مدة التسليم", "value": "فوري عبر تيليجرام" }
        ],
        "description": "<h3>الوصف (Description)</h3><p>احصل على اشتراك ChatGPT Plus الرسمي والكامل... (هذا نص تجريبي طويل).</p><ul><li>وصول لـ GPT-4</li><li>سرعة استجابة أعلى</li><li>مميزات حصرية</li></ul><h3>الوصف (English)</h3><p>Get the official ChatGPT Plus subscription...</p>",
        "reviews": [
          { "name": "أحمد", "rating": 5, "comment": "خدمة ممتازة وسريعة جداً!", "date": "2025-11-15" },
          { "name": "Sara", "rating": 4, "comment": "Good product, works as described.", "date": "2025-11-14" }
        ]
      },
      {
        "id": "adobe-creative-cloud",
        "title": "Adobe Creative Cloud (All Apps)",
        "price": 25.00,
        "oldPrice": 50.00,
        "rating": 5,
        "ratingCount": 92,
        "soldOut": true,
        "categories": ["Design", "Featured", "HotDeal"],
        "mainImage": "https://via.placeholder.com/400x400/ff0000/ffffff?text=Adobe",
        "galleryImages": ["https://via.placeholder.com/400x400/ff0000/ffffff?text=Adobe"],
        "specs": [{"key": "نوع المنتج", "value": "مفتاح تفعيل"}],
        "description": "<p>كل برامج أدوبي في اشتراك واحد.</p>",
        "reviews": []
      },
      {
        "id": "canva-pro",
        "title": "Canva Pro (Lifetime)",
        "price": 10.00,
        "oldPrice": 20.00,
        "rating": 4,
        "ratingCount": 77,
        "soldOut": false,
        "categories": ["Design", "BestSeller"],
        "mainImage": "https://via.placeholder.com/400x400/00c4cc/ffffff?text=Canva",
        "galleryImages": ["https://via.placeholder.com/400x400/00c4cc/ffffff?text=Canva"],
        "specs": [{"key": "نوع المنتج", "value": "دعوة لفريق"}],
        "description": "<p>اشتراك كانفا برو مدى الحياة.</p>",
        "reviews": []
      }
    ],
    cart: []
  };

  // ======================= 3. تحميل وحفظ البيانات (LocalStorage) =======================
  
  function loadState() {
    const savedState = localStorage.getItem('foxyStoreState');
    if (savedState) {
      // دمج الإعدادات المحفوظة مع الافتراضية لضمان إضافة أي إعدادات جديدة
      const parsedState = JSON.parse(savedState);
      state = {
        ...state, // الافتراضيات
        ...parsedState, // المحفوظ
        settings: { ...state.settings, ...parsedState.settings }, // دمج الإعدادات الداخلية
      };
    }
    // تحميل المراجعات المحفوظة لكل منتج
    state.products.forEach(p => {
      const savedReviews = localStorage.getItem(`foxy_reviews_${p.id}`);
      if (savedReviews) {
        p.reviews = JSON.parse(savedReviews);
      }
    });
    // تحميل السلة
    const savedCart = localStorage.getItem('foxyStoreCart');
    if(savedCart) {
      state.cart = JSON.parse(savedCart);
    }
  }

  function saveState(showSuccess = true) {
    try {
      // قراءة البيانات من المحررات
      state.products = JSON.parse(productsEditor.value);
      state.categories = JSON.parse(categoriesEditor.value);
      state.settings.socials = JSON.parse(settingsSocialLinks.value);

      // قراءة الإعدادات العامة
      state.settings.siteTitle = settingsSiteTitle.value;
      state.settings.siteLogo = settingsSiteLogo.value;
      state.settings.telegramLink = settingsTelegramLink.value;
      state.settings.whatsappLink = settingsWhatsappLink.value;
      state.settings.footerText = settingsFooterText.value;
      state.settings.copyrightText = settingsCopyright.value;
      
      // حفظ الحالة الرئيسية (بدون المراجعات والسلة)
      const stateToSave = { ...state, reviews: undefined, cart: undefined };
      localStorage.setItem('foxyStoreState', JSON.stringify(stateToSave));
      
      // حفظ السلة
      saveCart();
      
      if(showSuccess) alert('تم حفظ جميع التغييرات بنجاح!');
      
      // تطبيق فوري
      applySettings();
      renderAll();
      settingsModal.hide();

    } catch (e) {
      alert("خطأ فادح في تنسيق JSON! \nيرجى المراجعة والتأكد من الأقواس والفواصل. \n\n" + e.message);
    }
  }

  function saveReviews(productId) {
    const product = state.products.find(p => p.id === productId);
    if(product) {
      localStorage.setItem(`foxy_reviews_${product.id}`, JSON.stringify(product.reviews));
    }
  }

  function saveCart() {
    localStorage.setItem('foxyStoreCart', JSON.stringify(state.cart));
  }

  // ======================= 4. دوال تطبيق الإعدادات (Apply Settings) =======================
  
  function applySettings() {
    // تطبيق العنوان واللوجو
    document.title = "free chatgpt plus"; // ثابت حسب طلبك
    siteTitle.textContent = state.settings.siteTitle;
    siteLogoImg.src = state.settings.siteLogo;

    // تطبيق الفوتر
    footerLogoImg.src = state.settings.siteLogo;
    footerSiteTitle.textContent = state.settings.siteTitle;
    footerDescription.textContent = state.settings.footerText;
    footerCopyrightName.textContent = state.settings.copyrightText;
    
    // تطبيق روابط السوشيال
    footerSocialIcons.innerHTML = '';
    state.settings.socials.forEach(social => {
      footerSocialIcons.innerHTML += `<a href="${social.link}" target="_blank" title="${social.icon.replace('fab fa-', '')}"><i class="${social.icon}"></i></a>`;
    });

    // تطبيق زر واتساب
    whatsappFloatingBtn.href = state.settings.whatsappLink;

    // تحميل البيانات في لوحة التحكم
    productsEditor.value = JSON.stringify(state.products, null, 2);
    categoriesEditor.value = JSON.stringify(state.categories, null, 2);
    settingsSiteTitle.value = state.settings.siteTitle;
    settingsSiteLogo.value = state.settings.siteLogo;
    settingsTelegramLink.value = state.settings.telegramLink;
    settingsWhatsappLink.value = state.settings.whatsappLink;
    settingsFooterText.value = state.settings.footerText;
    settingsCopyright.value = state.settings.copyrightText;
    settingsSocialLinks.value = JSON.stringify(state.settings.socials, null, 2);
  }

  // ======================= 5. دوال رسم الواجهة (Render Functions) =======================

  // الدالة الشاملة لإعادة رسم كل شيء
  function renderAll() {
    renderTopCategories();
    renderAllProductSections();
    updateCartUI();
  }

  // رسم الفئات العلوية
  function renderTopCategories() {
    topCategoriesContainer.innerHTML = '';
    categoryDropdown.innerHTML = '';
    footerCategoryLinks.innerHTML = '';
    state.categories.forEach(cat => {
      const topCatHtml = `
        <a href="${cat.link}" class="category-item">
          <img src="${cat.image}" alt="${cat.name}">
          <span>${cat.name}</span>
        </a>`;
      topCategoriesContainer.innerHTML += topCatHtml;
      
      const dropdownHtml = `<li><a class="dropdown-item" href="${cat.link}">${cat.name}</a></li>`;
      categoryDropdown.innerHTML += dropdownHtml;

      const footerHtml = `<a href="${cat.link}">${cat.name}</a>`;
      footerCategoryLinks.innerHTML += footerHtml;
    });
  }
  
  // رسم كل أقسام المنتجات
  function renderAllProductSections(filter = "") {
    const searchTerm = filter.toLowerCase();
    const filteredProducts = state.products.filter(p => p.title.toLowerCase().includes(searchTerm));

    renderProductGrid(ourPicksGrid, filteredProducts.filter(p => p.categories.includes("Featured")));
    renderProductSlider(latestReleasesSlider, filteredProducts.filter(p => p.categories.includes("Latest")));
    renderProductSlider(bestSellersSlider, filteredProducts.filter(p => p.categories.includes("BestSeller")));
    renderProductGrid(hotDealsGrid, filteredProducts.filter(p => p.categories.includes("HotDeal")));
  }

  // دالة مساعدة لرسم كارت المنتج
  function createProductCard(product) {
    const priceOld = product.oldPrice ? `<span class="product-card-price-old">$${product.oldPrice.toFixed(2)}</span>` : '';
    const discount = product.oldPrice ? Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100) : 0;
    const discountBadge = discount > 0 ? `<span class="product-discount-badge">-${discount}%</span>` : '';
    const soldOutBadge = product.soldOut ? `<span class="product-sold-out-badge">SOLD OUT</span>` : '';
    const stars = renderStars(product.rating);

    return `
      <div class="product-card" data-product-id="${product.id}" ${product.soldOut ? 'style="opacity: 0.6;"' : ''}>
        <div class="product-card-img-wrap">
          <img src="${product.mainImage}" class="product-card-img" alt="${product.title}">
          ${soldOutBadge}
          ${!soldOutBadge && discountBadge ? discountBadge : ''}
        </div>
        <div class="product-card-body">
          <h5 class="product-card-title">${product.title}</h5>
          <div class="product-card-stars">${stars}</div>
          <div class="product-card-prices">
            ${priceOld}
            <span class="product-card-price-new">$${product.price.toFixed(2)}</span>
          </div>
        </div>
      </div>
    `;
  }

  // رسم قسم (Grid)
  function renderProductGrid(element, products) {
    element.innerHTML = '';
    if (products.length === 0) {
      element.innerHTML = '<p class="text-white-50">لا توجد منتجات لعرضها في هذا القسم.</p>';
      return;
    }
    products.forEach(product => {
      element.innerHTML += `<div class="col-lg-3 col-md-4 col-sm-6">${createProductCard(product)}</div>`;
    });
  }

  // رسم قسم (Slider)
  function renderProductSlider(element, products) {
    element.innerHTML = '';
    if (products.length === 0) {
      element.innerHTML = '<p class="text-white-50">لا توجد منتجات لعرضها في هذا القسم.</p>';
      return;
    }
    products.forEach(product => {
      element.innerHTML += `<div class="product-slider-item">${createProductCard(product)}</div>`;
    });
  }
  
  // دالة مساعدة لرسم النجوم
  function renderStars(rating) {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
      if (i <= rating) {
        stars += '<i class="fas fa-star"></i>';
      } else if (i - 0.5 <= rating) {
        stars += '<i class="fas fa-star-half-alt"></i>';
      } else {
        stars += '<i class="far fa-star"></i>';
      }
    }
    return stars;
  }

  // ======================= 6. دوال نافذة تفاصيل المنتج (Product Modal) =======================
  
  // فتح النافذة وملء البيانات
  function openProductModal(productId) {
    const product = state.products.find(p => p.id === productId);
    if (!product) return;

    // ربط هذا المودال بالمنتج الحالي
    productDetailModalEl.dataset.currentProductId = product.id;

    // (أ) المعلومات الأساسية
    productDetailTitle.textContent = product.title;
    mainProductImage.src = product.mainImage;
    productDetailPriceNew.textContent = `$${product.price.toFixed(2)}`;
    modalPurchaseLink.href = product.telegramLink || state.settings.telegramLink;
    
    // (ب) السعر القديم والخصم
    if (product.oldPrice && product.oldPrice > product.price) {
      productDetailPriceOld.textContent = `$${product.oldPrice.toFixed(2)}`;
      productDetailPriceOld.classList.remove('d-none');
      const discount = Math.round(((product.oldPrice - product.price) / product.oldPrice) * 100);
      productDetailDiscount.textContent = `خصم ${discount}%`;
      productDetailDiscount.classList.remove('d-none');
    } else {
      productDetailPriceOld.classList.add('d-none');
      productDetailDiscount.classList.add('d-none');
    }

    // (ج) معرض الصور
    productImageGallery.innerHTML = '';
    product.galleryImages.forEach((imgSrc, index) => {
      productImageGallery.innerHTML += `
        <img src="${imgSrc}" alt="صورة مصغرة ${index + 1}" 
             class="img-thumbnail ${index === 0 ? 'active' : ''}" 
             onclick="changeMainImage(this)">`;
    });

    // (د) المواصفات
    productDetailSpecs.innerHTML = '';
    product.specs.forEach(spec => {
      productDetailSpecs.innerHTML += `<li><span>${spec.key}</span> <strong>${spec.value}</strong></li>`;
    });

    // (هـ) الوصف
    productDetailDescription.innerHTML = product.description;

    // (و) التقييمات
    renderProductReviews(product);
    
    // (ز) زر إضافة للسلة
    if(product.soldOut) {
        modalAddToCartBtn.disabled = true;
        modalAddToCartBtn.textContent = "نفدت الكمية";
    } else {
        modalAddToCartBtn.disabled = false;
        modalAddToCartBtn.textContent = "أضف إلى السلة";
    }

    productDetailModal.show();
  }

  // دالة تغيير الصورة الرئيسية في المعرض
  window.changeMainImage = function(thumb) {
    mainProductImage.src = thumb.src;
    // تحديث الكلاس .active
    $$('#productImageGallery img').forEach(img => img.classList.remove('active'));
    thumb.classList.add('active');
  }

  // ======================= 7. دوال التقييمات (Reviews) =======================
  
  function renderProductReviews(product) {
    // 1. ملخص التقييمات
    const totalReviews = product.reviews.length;
    const averageRating = totalReviews > 0 
      ? (product.reviews.reduce((acc, r) => acc + r.rating, 0) / totalReviews) 
      : 5; // افتراضي 5 إذا لا توجد تقييمات

    product.rating = averageRating; // تحديث التقييم العام للمنتج

    reviewSummaryScore.textContent = averageRating.toFixed(1);
    reviewSummaryStars.innerHTML = renderStars(averageRating);
    reviewSummaryCount.textContent = `(${totalReviews} تقييمات)`;

    // 2. أشرطة التقييمات
    reviewProgressBars.innerHTML = '';
    for (let i = 5; i >= 1; i--) {
      const count = product.reviews.filter(r => r.rating === i).length;
      const percentage = totalReviews > 0 ? (count / totalReviews) * 100 : 0;
      reviewProgressBars.innerHTML += `
        <div class="d-flex align-items-center mb-1">
          <span class="text-muted me-2">${i} نجوم</span>
          <div class="progress flex-grow-1">
            <div class="progress-bar progress-bar-gold" role="progressbar" style="width: ${percentage}%" aria-valuenow="${percentage}"></div>
          </div>
        </div>`;
    }

    // 3. قائمة التعليقات
    productDetailReviewsList.innerHTML = '';
    if (totalReviews === 0) {
      productDetailReviewsList.innerHTML = '<p class="text-muted">لا توجد تقييمات لهذا المنتج بعد.</p>';
    } else {
      product.reviews.forEach(review => {
        productDetailReviewsList.innerHTML += `
          <div class="review-card">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <strong>${review.name}</strong>
              <small class="text-muted">${new Date(review.date).toLocaleDateString()}</small>
            </div>
            <div class="review-stars mb-2">${renderStars(review.rating)}</div>
            <p class="mb-0">${review.comment}</p>
          </div>`;
      });
    }

    // 4. إعادة تعيين فورم التقييم
    reviewForm.reset();
    currentReviewRating = 0;
    $$('#reviewRatingInput i').forEach(star => {
      star.classList.remove('fas');
      star.classList.add('far');
    });
  }

  // التعامل مع إدخال النجوم
  reviewRatingInput.addEventListener('click', e => {
    if (e.target.matches('i')) {
      currentReviewRating = parseInt(e.target.dataset.value, 10);
      $$('#reviewRatingInput i').forEach(star => {
        if (parseInt(star.dataset.value, 10) <= currentReviewRating) {
          star.classList.add('fas');
          star.classList.remove('far');
        } else {
          star.classList.remove('fas');
          star.classList.add('far');
        }
      });
    }
  });

  // إرسال التقييم
  reviewForm.addEventListener('submit', e => {
    e.preventDefault();
    const productId = productDetailModalEl.dataset.currentProductId;
    const product = state.products.find(p => p.id === productId);

    if (product && currentReviewRating > 0) {
      const newReview = {
        name: $('reviewName').value,
        rating: currentReviewRating,
        comment: $('reviewComment').value,
        date: new Date().toISOString()
      };
      
      product.reviews.unshift(newReview); // إضافة المراجعة الجديدة في الأول
      saveReviews(product.id); // حفظ المراجعات في localStorage
      renderProductReviews(product); // إعادة رسم قسم المراجعات
      renderAllProductSections(); // إعادة رسم الكروت في الصفحة الرئيسية (لتحديث النجوم)
    } else {
      alert("يرجى اختيار تقييم (عدد النجوم) قبل الإرسال.");
    }
  });


  // ======================= 8. دوال سلة المشتريات (Shopping Cart) =======================
  
  function addToCart(productId) {
    const product = state.products.find(p => p.id === productId);
    if (!product || product.soldOut) return;
    
    const existingItem = state.cart.find(item => item.id === productId);
    
    if (existingItem) {
      existingItem.quantity++;
    } else {
      state.cart.push({
        id: product.id,
        title: product.title,
        price: product.price,
        mainImage: product.mainImage,
        quantity: 1
      });
    }
    
    saveCart();
    updateCartUI();
    // إظهار تنبيه
    showToast(`${product.title} تمت إضافته للسلة!`);
  }

  function removeFromCart(productId) {
    state.cart = state.cart.filter(item => item.id !== productId);
    saveCart();
    updateCartUI();
  }

  function updateCartQuantity(productId, quantity) {
    const item = state.cart.find(item => item.id === productId);
    if(item) {
      item.quantity = parseInt(quantity, 10);
      if (item.quantity <= 0) {
        removeFromCart(productId);
      } else {
        saveCart();
        updateCartUI();
      }
    }
  }

  function updateCartUI() {
    cartBody.innerHTML = '';
    let total = 0;
    
    if (state.cart.length === 0) {
      cartBody.innerHTML = '<div class="cart-empty-message">سلتك فارغة حالياً.</div>';
      cartBadge.textContent = '0';
      cartTotal.textContent = '$0.00';
      cartCheckoutLink.classList.add('disabled');
      return;
    }
    
    state.cart.forEach(item => {
      total += item.price * item.quantity;
      cartBody.innerHTML += `
        <div class="cart-item">
          <img src="${item.mainImage}" alt="${item.title}" class="cart-item-img">
          <div class="cart-item-details">
            <div class="cart-item-title">${item.title}</div>
            <div class="cart-item-price">$${item.price.toFixed(2)}</div>
          </div>
          <input type="number" class="form-control form-control-sm cart-item-quantity" value="${item.quantity}" min="1" data-id="${item.id}">
          <button class="btn btn-link text-danger cart-item-remove" data-id="${item.id}"><i class="fas fa-trash"></i></button>
        </div>
      `;
    });
    
    cartBadge.textContent = state.cart.length;
    cartTotal.textContent = `$${total.toFixed(2)}`;
    cartCheckoutLink.classList.remove('disabled');
    
    // إنشاء رسالة تيليجرام
    let telegramMessage = `مرحباً، أريد شراء المنتجات التالية من سلتي:\n\n`;
    state.cart.forEach(item => {
      telegramMessage += `- ${item.title} (الكمية: ${item.quantity}) - $${(item.price * item.quantity).toFixed(2)}\n`;
    });
    telegramMessage += `\n*المجموع الكلي: $${total.toFixed(2)}*`;
    
    // تحديث رابط الدفع لتيليجرام
    cartCheckoutLink.href = `${state.settings.telegramLink}?text=${encodeURIComponent(telegramMessage)}`;
  }

  // إضافة منتج للسلة من داخل المودال
  modalAddToCartBtn.addEventListener('click', () => {
    const productId = productDetailModalEl.dataset.currentProductId;
    addToCart(productId);
    productDetailModal.hide();
    cartModal.show();
  });

  // أحداث السلة (حذف أو تغيير كمية)
  cartBody.addEventListener('click', e => {
    if (e.target.closest('.cart-item-remove')) {
      const productId = e.target.closest('.cart-item-remove').dataset.id;
      removeFromCart(productId);
    }
  });
  cartBody.addEventListener('change', e => {
    if (e.target.classList.contains('cart-item-quantity')) {
      const productId = e.target.dataset.id;
      const quantity = e.target.value;
      updateCartQuantity(productId, quantity);
    }
  });

  // ======================= 9. دوال لوحة التحكم (Settings) =======================
  
  loginBtn.addEventListener('click', () => {
    if (passInput.value === state.secret) {
      loginScreen.classList.add('d-none');
      toolsScreen.classList.remove('d-none');
      loginError.classList.add('d-none');
    } else {
      loginError.classList.remove('d-none');
    }
  });
  
  settingsModalEl.addEventListener('hidden.bs.modal', function () {
     loginScreen.classList.remove('d-none');
     toolsScreen.classList.add('d-none');
     passInput.value = '';
     loginError.classList.add('d-none');
  });

  saveBtn.addEventListener('click', () => saveState(true));

  // ======================= 10. البحث (Search) =======================
  
  globalSearchForm.addEventListener('submit', e => {
    e.preventDefault();
    const searchTerm = globalSearchInput.value;
    renderAllProductSections(searchTerm);
  });
  
  // (اختياري) تصفير البحث عند مسح الحقل
  globalSearchInput.addEventListener('input', e => {
    if (e.target.value === "") {
      renderAllProductSections("");
    }
  });

  // ======================= 11. تشغيل التطبيق (Initialization) =======================
  
  // فتح مودال المنتج عند الضغط على كارت
  document.body.addEventListener('click', e => {
    const card = e.target.closest('.product-card');
    if (card) {
      e.preventDefault();
      const productId = card.dataset.productId;
      openProductModal(productId);
    }
  });

  // دالة لإظهار تنبيه سريع (Toast)
  function showToast(message) {
    // إنشاء عنصر التنبيه
    const toastEl = document.createElement('div');
    toastEl.className = 'toast align-items-center text-bg-success border-0 position-fixed top-0 start-50 translate-middle-x m-3';
    toastEl.style.zIndex = "1100"; // فوق كل شيء
    toastEl.innerHTML = `
      <div class="d-flex">
        <div class="toast-body">
          <i class="fas fa-check-circle me-2"></i>
          ${message}
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    `;
    document.body.appendChild(toastEl);
    
    const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
    toast.show();
    
    // حذف العنصر بعد إغلاقه
    toastEl.addEventListener('hidden.bs.toast', () => {
      toastEl.remove();
    });
  }

  // أول تحميل
  loadState();
  applySettings();
  renderAll();

}); // نهاية DOMContentLoaded
